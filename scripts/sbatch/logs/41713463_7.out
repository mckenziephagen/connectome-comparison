#!/bin/bash
#SBATCH --qos=shared
#SBATCH --time=24:00:00
#SBATCH --constraint=cpu
#SBATCH --ntasks=1
#SBATCH --job-name=shared
#SBATCH --array=7
#SBATCH --cpus-per-task=1
#SBATCH --error logs/%A_%a.error
#SBATCH --out logs/%A_%a.out
#SBATCH --account=m1266

#SBATCH --mail-type=ALL
#SBATCH --mail-user=mphagen@uw.edu

#activate conda envs
source /global/homes/m/mphagen/.bashrc
conda activate fc_py311

#variable definition
script="/global/homes/m/mphagen/functional-connectivity/connectome-comparison/scripts/processing/calc_fc.py"
subject_file="/global/homes/m/mphagen/functional-connectivity/connectome-comparison/data/test_subjects.txt"

cat $0

subject_id=$( sed -n $(($SLURM_ARRAY_TASK_ID))p $subject_file )
echo $subject_id

srun --cpu-bind=cores python $script --sub_id $subject_id --model 'uoiLasso' --ses_id 'ses-1'



204521
Namespace(sub_id='204521', ses_id='1', task_id='rest', atlas_spec='fsLR_seg-4S156Parcels_den-91k', n_rois=100, n_trs=1200, n_folds=5, model='uoiLasso', cv='blocks', proc_type='minProc', profile=False, fc_data_path='/pscratch/sd/m/mphagen/hcp-functional-connectivity', max_iter=1000)
Found 1 rest scans for subject 204521.
Saving results to /pscratch/sd/m/mphagen/hcp-functional-connectivity/derivatives/connectivity-matrices/minProc/uoiLasso_blocks/sub-204521.
UoI_Lasso(estimation_score='BIC', n_lambdas=100,
          random_state=RandomState(MT19937) at 0x7F35329D8D40,
          selection_frac=0.7, stability_selection=16)
Calculating uoiLasso FC for 204521 1
uoiLasso
Fold 0:
  Train: range=0, 1919
  Test:  index=1920, 2399
6662.537547826767  seconds
Fold 1:
  Train: range=0, 2399
  Test:  index=1440, 1919
6757.879814386368  seconds
Fold 2:
  Train: range=0, 2399
  Test:  index=960, 1439
6609.341699123383  seconds
Fold 3:
  Train: range=0, 2399
  Test:  index=480, 959
6655.3817319869995  seconds
Fold 4:
  Train: range=480, 2399
  Test:  index=0, 479
6674.137249708176  seconds
